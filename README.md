**bookMe**

#Движок
##Расписания (schedules)
Задаются через RruleSetы, которые создаются за счёт модифицированных Rrules.
Модификация заключается в добавлении одного свойства - duration (длительность).
Например, если мы хотим создать рабочий день с перерывом на час в середине него, мы создаем RRuleSet как минимум с двумя правилами:
1. Общий интервал работы (8 часов)
2. Исключённый из него интервал отдыха 1 час.

##Запись - плановая запись
Свойства:
resourceIds - массив ресурсов. Так как в будущем возможно будет реализвана функция записи сразу к двум ресурсам - например, к двум девушкам на сеанс массажа в 4-е руки.
rentersIds - массив тех, кто записался. Это для отражения записи на групповые занятия.
Нужно различать плановые значения длительности и числа людей и тренеров и плановую цену и фактические.

## Груповые занятия, занятия с несколькими тренерами и реквизиты услуг
Для групповых занятий и для получения услуги от нескольких тренеров в составе услуг должны быть указаны требования к этому: 
- необходимость наличия для успешности услуги двух ресурсов-людей по такому-то матчеру
- наличие минимально необходимого (чтобы состоялось) и максимально возможного (группа не боле 20 человек) числа людей, которые смогут воспринять услугу.
- также могут быть сформулированы требования к rentners, в плане - можно ли им оказать услугу. Например, не младше 18 лет. Или не более 10 человек, а за каждого последующего - наценка. @todo Как её реализовать? Через переменные передаваемые в расчёт цены и формулы.
- также могут быть услуги с нефиксированным временем - по факту.

##Дела и записи
Фактическое выполнение дел и записи могут существовать только как отдельные вещи. Это происходит из-за того, что дело конкретно, а запись может быть повторяющейся

#Сущности
##Ресурс
###Человек
###Ареал
Вложенный ресурс для отображения зданий, этажей, помещений и мест в помещениях.
К нему также относится недвижимое оборудование (например, солярий), занимающее место в помещении.
##Услуга
Услуга это конкретный пункт прайса (точнее несколько в случае если меняется только цена). 
Например, массаж "Цветок Лотоса" или массаж спины.
А отнесение услуг к типам: например, Тайский массаж или Классический массаж. Это просто классификация вышеупомянутых услуг.
 
##Цены
Производная от сочетания ресурсов, времени, арендатора, услуги.
Назначение происходит посредством сопоставления атрибутов subject, object и environment.
@todo [функциональность][не очень срочное] Добавить функцию округления после расчёта цены (прямо внутрь функции с коэффициентом - т.е. чтобы формулы переваривало). Это в случае, если эффект достигается посредством умножения длительности на коэффициент.
@todo [функциональность][не очень срочное] Добавить функцию округления после расчёта цены (прямо внутрь функции с коэффициентом). Это в случае, если эффект достигается посредством умножения длительности на коэффициент.
@todo [функциональность][очень отдалённое] Добавить функцию логарифма или чего-то такого, чтобы были нелинейные зависимости. 

##Скидки
Виды скидок:
Скидки за что-либо. В том числе, разовые скидки, связанные с акциями разными. В том числе, сезонные скидки и т.п.
Назначаются по типу ABAC.
1) shift - сложение / вычитание. Пример: скидка -100 рублей.  
2) coefficient - умножение/деление. Пример: скидка 5%.
fullPrice = price * coefficientReduction + shiftReduction.

Скидки, связанный с общими стоимостями покупок
1) discount - от общей стоимости разовой покупки
3) accumulative - накопительный %, но может сгорать каждый месяц или год.
4) bonus - бонусы откладываются (типа миль) от общих стоимостей покупок, а потом ими вместо денег можно платить.  
Получается, что бонус это отдельный вид кошелька как-бы.
В расчёте цены непосредственно учитывается discount и reduction и accumulative.
Bonus - появляются при оплате и расходуются при ней же, если ими оплачивать. 
shift - это ещё и изменение цены в большую сторону за что-либо.
Может ещё добавить такой способ определения размера скидки как random. Случайная скидка в каком-то диапазоне.
### Дискаунт
Скидка даётся с количества. Т.е. с суммы чека. Данная скидка коэффициентная.

##Может в понятие ABAC-окружения ввести понятие акций?

##Арендатор
Тот, кто записывается на приём


#Вспомогательные вещи
##Формулы
Появились зарезервированные имена переменных:
"$duration" - длительность в минутах.

##Даты
Внутри программы должны измеряться во времени UTC.
При работе с пользователем (ввод-вывод), - текущая локаль. Автоопределяемая или задаваемая в настройках.

##Логгирование
Кто, что и когда изменил. Кого-то к кому-то перезаписал и т.п.



##Длительности
Измеряются в минутах.
Типы длительностей
- Интервальная (тут указывается минимальный и максимальный интервал (1 - 3 часа) и шаг интервала любой / 15 минут и т.п.)
- На выбор: задан массив конкретных длительностей
betweenTime: Время между сеансами услуг (время на уборку, на подготовку, на отдых ресурса):

##Записи
- о фактических оплатах
- о фактических делах

 

##Работа с политиками
### Случай с комбинированными ресурсами
//@todo [юзабилити][срочное] Что делать, если это комбинированный ресурс? Видимо, знать, что он комбинированный. Делать в комбинированном ресурсе объект с напрямую вложенными в него комбинированными ресурсами и писать матчер, с учётом этого.
### Если подходят несколько политик
Если подходят несколько политик, мы приходим к необходимости алгоритма, комбинирующего их результаты.
Вид этого алгоритма указан в settings - настройках программы
@todo [функциональность][очень отдалённое] Возможно, стоит ввести понятие набора политик, у него и будет указываться combining-алгоритм. В текущий момент нахожу это излишней сложностью
Алгоритмы, комбинирующие результаты: $mean, $median, $min, $max, $sum. 
@todo [юзабилити][отдалённое] Можно добавить такой алгоритм, как наиболее специфицированная политика - т.е.та, в которой больше свойств проверяется. Также можно добавить и противоположность - менее специфицированная.
@todo [юзабилити][отдалённое] Можно добавить такой алгоритм, как $random. Например, если говорим о скидках и их несколько получено, то он случайным образом выбирает. Вряд ли такой нужен. Скорее нужен такой способ определения размера скидки как random 
#### Если подходят несколько политик одной цене
Ничего страшного, в случае с ценами нужно брать комбинирующий алгоритм max. Или более специфичную политику (такой алгоритм стоит в todo).

#Алгоритмы
##Основной
1. Наборам ресурсов создаётся расписание.
2. Арендатор может записаться к набору ресурсов.
## Выбор конкретного набора ресурсов, чтобы понять куда записаться
1. Выбор произвольного набора конкретных ресурсов или их характеристик (категория специалиста, вид специалиста).
2. Просмотр вариантов в календаре

#Взаимосвязь с другими проектами
##Архетип услуги
В данном случае это задача по типу встречи (календарное время). Она может быть групповой.
Раз задача, то должна быть отметка о выполнении.

#Автодокументация
npm i -g jsdoc docdash

См. https://eugen35.gitbooks.io/varia/content/auto_doc_generation.html

#Тестирование
##Запуск тестов
npm test
npm test: watch
##Используемые пакеты
jest.
А для assertions пытаюсь использовать chai. Но похоже нужен мостик между ним и jest.
А то не выводится развернутых комментариев в консоль о том, что именно не совпало (например, при сравнении массивов).
##В текущий момент что-то крашится в тестах

#Установка переменных окружения
Как-то на винде у меня не работает указание их в командной строке. А точнее работает, но для серверных скриптов.
А даже сборщик webpack уже не видит эти переменные.
Поэтому ручками меняю их в файле env_gitignored.js (тока нужно в гите раскомментировать гитигнор данного файла).
Сборка в варианте production отключает redux-devtools от правой части экрана.

# Running Example

First, clone the project:

```
git clone https://github.com/gaearon/redux-devtools.git
```

Then install the dependencies in the root folder:

```
cd redux-devtools
npm install
```

Install the dependencies in the example folder:

```
cd examples/todomvc
npm install
```

Finally, run the project:

```
npm start
open http://localhost:3000
```

#Hot reload problems

##Webpack does not watch on Windows and WebStorm
seems Webpack watch doesn't work if the file is not saved directly. Please try turning 'Safe write' option ( Settings | Appearance & Behavior | System Settings | Use "safe write" (save changes to temporary file first)) off

+ если верхнее не помогает, то к нему можно добавить в файл webpack.config.js среди списка опций следующую:
```
...
watchOptions: {
aggregateTimeout: 300, // Delay the rebuilt after the first change. Value is a time in ms.
//poll: true // bool - enable / disable polling or number - polling delay
poll: 1000
}
...
```

